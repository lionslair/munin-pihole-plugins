# munin-pihole-plugins

[Munin](https://munin-monitoring.org) [plugins](https://gallery.munin-monitoring.org) and management script for monitoring various [Pi-hole®](https://github.com/pi-hole/pi-hole) statistics. Transforms a server into a powerful monitoring platform, as simple as [one](https://github.com/saint-lascivious/munin-pihole-plugins#step-one-download), [two](https://github.com/saint-lascivious/munin-pihole-plugins#step-two-install), [three](https://github.com/saint-lascivious/munin-pihole-plugins#step-three-wait), ...[four](https://github.com/saint-lascivious/munin-pihole-plugins#step-four-monitor).

## Step One: Download
* Download munin-pihole-plugins
```
curl -sSL munin-pihole-plugins.sainternet.xyz -o munin-pihole-plugins && chmod +x munin-pihole-plugins
```

## Step Two: Install
* Install munin-pihole-plugins
```
./munin-pihole-plugins --install
```
Dependencies are checked and met using `dpkg-query` and `apt` respectively, you will be prompted before any unmet dependencies are installed. A copy of the munin-pihole-plugins script will also be installed on the host in /usr/local/bin by default. The munin-pihole-plugins script directory can be configured, or munin-pihole-plugins script installation may be disabled entirely.

## Step Three: Wait
* Wait, around five minutes

While graphs are generated by the Munin master on-demand using cgi graph strategy, Munin nodes run plugins periodically, by default at 5 minute intervals past the hour. Check out the [full help text](https://github.com/saint-lascivious/munin-pihole-plugins#full-help-text) while you wait.

## Step Four: Monitor
* Navigate to http://MUNIN_SERVER_FQDN_HOSTNAME_OR_IP/munin in a browser to view the Munin monitoring interface

If everything went well, you should find [munin-pihole-plugins graphs](https://github.com/saint-lascivious/munin-pihole-plugins#example-graph-gallery) available to view in the 'dns' category. Otherwise, see the [help section](https://github.com/saint-lascivious/munin-pihole-plugins#help-my-graphs-arent-showing-up).

## Full Help Text
* Full `munin-pihole-plugins` help text
```
Usage: munin-pihole-plugins [option]
Example: munin-pihole-plugins --install

Options:
   -h, --help           Display this help dialogue

   -i, --install        Install and configure munin-pihole-plugins

   -u, --uninstall      Uninstall munin-pihole-plugins

   -U, --update         Update munin-pihole-plugins

   -v, --version        Display the current and latest munin-pihole-plugins
                        script versions

   -V, --variables      Display a list of environment variables used by
                        munin-pihole-plugins, and their current values
```

## Example Graph Gallery
* pihole_blocked
![pihole_blocked-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_blocked-day.png)
* pihole_cache
![pihole_cache-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_cache-day.png)
* pihole_cache_by_type
![pihole_cache_by_type-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_cache_by_type-day.png)
* pihole_clients
![pihole_clients-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_clients-day.png)
* pihole_percent
![pihole_percent-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_percent-day.png)
* pihole_queries
![pihole_queries-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_queries-day.png)
* pihole_replies_by_type
![pihole_replies_by_type-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_replies_by_type-day.png)
* pihole_status
![pihole_status-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_status-day.png)
* pihole_status
![pihole_unique_domains-day.png](https://raw.githubusercontent.com/saint-lascivious/munin-pihole-plugins/master/gallery/pihole_unique_domains-day.png)

## Plugin Configuration
* Default `/etc/munin/plugin-conf.d/pihole` plugin configuration
```
[pihole_*]
    user root
    env.host 127.0.0.1
    env.port 80
    env.api /admin/api.php
    env.cachesuffix ?getCacheInfo&auth=
    env.webpassword PIHOLE_SETUPVARS_WEBPASSWORD_HERE
```
Provided munin-node and Pi-hole® exist on the same host, the default configuration should Just Work. If you have a non-standard configuration or Pi-hole® is running on a seperate host, you will need to edit the plugin configuration. The `env.webpassword` value can be obtained from the Pihole host's `/etc/pihole/setupVars.conf` file. The plugins attempt to obtain this value themselves.

## Script Configuration
* Default `munin-pihole-plugins` environment variables
```
Usage: export [VARIABLE]="value"
Example: export PLUGIN_LIST="blocked cache replies_by_type"

Variables:
   INSTALL_SCRIPT="true"

   INSTALL_WEBSERVER="true"

   MUNIN_DIR="/etc/munin"

   MUNIN_CONFIG_DIR="/etc/munin/munin-conf.d"

   MUNIN_PLUGIN_DIR="/usr/share/munin/plugins"

   NODE_PLUGIN_DIR="/etc/munin/plugins"

   PLUGIN_CONFIG_DIR="/etc/munin/plugin-conf.d"

   PLUGIN_LIST="blocked cache cache_by_type clients percent queries replies_by_type status unique_domains"

   PROXY_CONFIG_DIR="/etc/lighttpd"

   SCRIPT_DIR="/usr/local/bin"

   SKIP_DEPENDENCY_CHECK="false"

   VERBOSE_OUTPUT="true"
```

## Help! My graphs aren't showing up!

* Be patient

Graphs should be generated at five minute intervals. If you still do not see graphs after this time, try restarting the machine and waiting a further five minutes. If you still can not get any graphs to display, [contact me](https://github.com/saint-lascivious/munin-pihole-plugins#contact) for further support.

## Contact
* Discord
[SaintLascivious](https://discord.gg/NC7taVyn)

* Email
saint@sainternet.xyz

* IRC
[##saint-lascivious](https://webchat.freenode.net/##saint-lascivious)

* Reddit
[saint-lascivious](https://www.reddit.com/user/saint-lascivious)

![alt text][logo]

[logo]:https://vignette.wikia.nocookie.net/pokemon/images/7/76/265Wurmple.png "Using the spikes on its rear end, Wurmple peels the bark off trees and feeds on the sap that oozes out. This Pokémon's feet are tipped with suction pads that allow it to cling to glass without slipping."

## Related projects
* [lighttpd-external-munin-proxy](https://github.com/saint-lascivious/lighttpd-external-munin-proxy)

lighttpd external.conf for Munin webserver proxy

* [munin-unbound-plugins](https://github.com/saint-lascivious/munin-unbound-plugins)

Munin monitoring plugins for Unbound

* [Munin](https://github.com/munin-monitoring/munin)

Main repository for munin master / node / plugins

* [Pi-hole®](https://github.com/pi-hole/pi-hole)

A black hole for Internet advertisements

* [Unbound](https://github.com/NLnetLabs/unbound)

Unbound is a validating, recursive, caching DNS resolver.
